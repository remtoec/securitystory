<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>戀愛大冒險 (Relationship Adventure)</title>
    
    <!-- Tailwind CSS (Via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Via CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX (Via CDN) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Prevent scrolling and bounce effects on mobile */
        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            overscroll-behavior: none;
            background-color: #bae6fd;
        }
        .font-comic {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', sans-serif;
        }
        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useLayoutEffect, useRef } = React;

        // --- Icons ---
        const IconBase = ({ size, className = "", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className} style={{ width: '1em', height: '1em' }}>{children}</svg>
        );
        const MessageCircle = (props) => <IconBase {...props}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" /></IconBase>;
        const Heart = (props) => <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></IconBase>;
        const ArrowRight = (props) => <IconBase {...props}><path d="M5 12h14" /><path d="m12 5 7 7-7 7" /></IconBase>;
        const RefreshCcw = (props) => <IconBase {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" /><path d="M16 16h5v5" /></IconBase>;
        const User = (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></IconBase>;
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></IconBase>;

        // --- AUTO FIT TEXT COMPONENT ---
        // Dynamically scales font size to fit the container height
        const AutoFitText = ({ text, className, minSize = 12, maxSize = 22 }) => {
            const containerRef = useRef(null);
            const textRef = useRef(null);
            
            // We use a state to trigger re-render with new size, but initial adjustment happens via DOM
            const [fontSize, setFontSize] = useState(maxSize);

            useLayoutEffect(() => {
                const container = containerRef.current;
                const textEl = textRef.current;
                if (!container || !textEl) return;

                // 1. Reset to max size to measure true overflow
                textEl.style.fontSize = `${maxSize}px`;
                textEl.style.lineHeight = '1.3'; // Tight line height helps fitting

                let currentSize = maxSize;
                
                // 2. Binary-like reduction or simple loop
                // We loop down until it fits or hits minSize
                // Check overflow: scrollHeight > clientHeight
                while (
                    (container.scrollHeight > container.clientHeight || 
                     container.scrollWidth > container.clientWidth) && 
                    currentSize > minSize
                ) {
                    currentSize -= 0.5; // Decrease by 0.5px steps for precision
                    textEl.style.fontSize = `${currentSize}px`;
                }
                
                // 3. Update state to sync React (optional, mainly for consistency)
                setFontSize(currentSize);
                
            }, [text, maxSize, minSize, window.innerHeight]); // Re-run on text change or resize

            return (
                <div ref={containerRef} className={`w-full h-full overflow-hidden ${className}`}>
                    <div ref={textRef} style={{ fontSize: `${maxSize}px` }} className="font-bold text-black font-comic leading-snug">
                        {text}
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const RelationshipComic = () => {
            const [gameState, setGameState] = useState('setup'); 
            const [userGender, setUserGender] = useState(null);
            
            const [currentStoryIndex, setCurrentStoryIndex] = useState(0);
            const [currentSceneIndex, setCurrentSceneIndex] = useState(0);
            const [scores, setScores] = useState({ secure: 0, insecure: 0 });
            const [history, setHistory] = useState([]);
            const [branchPath, setBranchPath] = useState(null);

            // --- DATA ---
            const getStories = (gender) => {
                const isUserMale = gender === 'M';
                const partner1 = isUserMale ? "Rachel" : "Ryan";
                const partner2 = isUserMale ? "Stacy" : "Steven"; 
                const partner4 = isUserMale ? "Christy" : "Chris"; 
                const rivalDescription = isUserMale ? "同你差唔多大嘅男仔" : "同你差唔多大嘅女仔";
                const neighborLabel = "一齊長大嘅街坊";
                const friendGroup = isUserMale ? "姊妹" : "兄弟";
                const himHer = "佢"; 

                return [
                {
                    id: 'story1',
                    title: `故事一：${partner1} 的情境`,
                    scenes: [
                    {
                        id: 's1_1',
                        narrator: `${partner1} 成晚都喺屋企照顧緊你。突然間，${himHer}收到個電話，行咗去另一間房聽。${himHer}返嚟話頭先係 Ex 打嚟 Say Hello。你知道佢哋再見亦是朋友，間唔中都有聯絡。`,
                        dialogue: {
                        speaker: partner1,
                        text: "其實我仲有同個 Ex 聯絡，你介唔介意㗎？"
                        },
                        options: [
                        { label: "A", text: "OK 呀，再見亦是朋友嘛，我都戥你開心嘅。", type: 'secure' },
                        { label: "B", text: "麻麻地囉，硬係覺得你哋兩個仲有啲嘢咁。", type: 'insecure' }
                        ]
                    },
                    {
                        id: 's1_2',
                        narrator: `${partner1} 繼續講${himHer}前度嘅嘢，你開始覺得有啲呷醋。其實上個禮拜，有個你以前幾好感嘅人打嚟約你出街，但當時你覺得無咩大不了所以無講。而家你突然醒返起呢單嘢，心諗如果講佢知，佢應該都會呷醋。`,
                        dialogue: {
                        speaker: "內心獨白",
                        text: "佢係咁講個 Ex... 我應唔應該提下有人約我嗰單嘢?"
                        },
                        options: [
                        { label: "A", text: "唔提算數，費事佢呷醋。", type: 'secure' },
                        { label: "B", text: "扮無嘢提下有人約我，希望佢會覺得有啲呷醋。", type: 'insecure' }
                        ]
                    },
                    {
                        id: 's1_3',
                        narrator: `之後嗰個禮拜，${partner1} 嚟到你屋企。你哋一齊玩得好開心嗰陣，開始傾起關於你哋段關係嘅話題。`,
                        dialogue: {
                        speaker: partner1,
                        text: "我覺得我哋開始認真喇，係時候傾下大家嘅將來點行。"
                        },
                        options: [
                        { label: "A", text: "好提議呀，大家目標一致，段關係先長久嘛。", type: 'secure' },
                        { label: "B", text: "不如我哋分開冷靜下...（你驚佢想分手，所以你想斬纜先）", type: 'insecure' }
                        ],
                        isEnd: true
                    }
                    ]
                },
                {
                    id: 'story2',
                    title: `故事二：${partner2} (支持型)`,
                    scenes: [
                    {
                        id: 's2_1',
                        narrator: `今日你去 ${partner2} 屋企食飯見家長。${partner2} 感覺到你有些少緊張，所以成晚都攬實你安撫你。食食下飯門鐘響，有個${rivalDescription}行入嚟，好熱情咁行埋去攬咗 ${partner2} 一下。${partner2} 介紹話佢係${neighborLabel}。嗰個人走嗰陣，畀咗個新電話號碼 ${partner2} 叫佢得閒搵佢。\n\n你哋食完飯上返車，準備走嗰陣...`,
                        dialogue: {
                        speaker: "內心獨白",
                        text: "佢哋似係老死，不過頭先個動作..."
                        },
                        options: [
                        { label: "A", text: "唔出聲，當佢哋係老死就算。", type: 'secure' },
                        { label: "B", text: `直接叫佢唔好打畀嗰個人。`, type: 'insecure' }
                        ]
                    },
                    {
                        id: 's2_2',
                        narrator: `${partner2} 開始講起嗰個人，話佢哋一齊長大，係好耐嘅老死。見你無咩點出聲，佢就主動向你保證，話佢無打算打畀對方。\n\n之後喺返屋企途中，你約 ${partner2} 聽晚食飯。佢話：「我約咗朋友出去呀。」你以前都同過佢成班朋友出去好多次，所以當佢就咁完咗個話題又無叫埋你，你覺得好驚訝。`,
                        dialogue: {
                        speaker: "你",
                        text: "..."
                        },
                        options: [
                        { label: "A", text: `問：「係咪成班${friendGroup}去玩呀？」`, type: 'secure' },
                        { label: "B", text: "問：「係咪有咩唔妥呀？」", type: 'insecure' }
                        ],
                        isEnd: true
                    }
                    ]
                },
                {
                    id: 'story3',
                    title: `故事三：${partner2} (不支持型)`,
                    scenes: [
                    {
                        id: 's3_1',
                        narrator: `今日你去 ${partner2} 屋企食飯見家長。食食下飯門鐘響，有個${rivalDescription}行入嚟，好熱情咁行埋去攬咗 ${partner2} 一下。${partner2} 介紹話佢係${neighborLabel}。有一刻，${partner2} 淨係顧住同嗰個人傾偈，無視你講緊咩。嗰個人走嗰陣，畀咗個新電話號碼 ${partner2} 叫佢得閒搵佢。\n\n你哋食完飯上返車，準備走嗰陣...`,
                        dialogue: {
                        speaker: "內心獨白",
                        text: "佢完全當我透明，嗰個人仲要畀埋電話佢..."
                        },
                        options: [
                        { label: "A", text: "唔出聲，當佢哋係老死就算。", type: 'secure' },
                        { label: "B", text: `直接叫佢唔好打畀嗰個人。`, type: 'insecure' }
                        ]
                    },
                    {
                        id: 's3_2',
                        narrator: `${partner2} 提到佢哋係一齊長大嘅老死。之後喺返屋企途中，你約 ${partner2} 聽晚食飯。佢話：「我約咗朋友出去呀。」你以前都同過佢成班朋友出去好多次，所以當佢就咁轉話題又無叫埋你，你覺得好驚訝。`,
                        dialogue: {
                        speaker: "你",
                        text: "..."
                        },
                        options: [
                        { label: "A", text: `問：「係咪成班${friendGroup}去玩呀？」`, type: 'secure' },
                        { label: "B", text: "問：「係咪有咩唔妥呀？」", type: 'insecure' }
                        ],
                        isEnd: true
                    }
                    ]
                },
                {
                    id: 'story4',
                    title: `故事四：${partner4} 分支`,
                    isBranching: true,
                    scenes: [
                    {
                        id: 's4_1',
                        branchId: 'root',
                        narrator: `${partner4} 收個電話行開咗。二十分鐘後佢返嚟，話頭先係 Ex 打嚟 Say Hello。你知道佢哋再見亦是朋友，間唔中都有聯絡。`,
                        dialogue: {
                        speaker: partner4,
                        text: "其實我仲有同個 Ex 聯絡，你介唔介意㗎？"
                        },
                        options: [
                        { label: "A", text: "OK 呀，再見亦是朋友嘛，我都戥你開心嘅。", type: 'secure', setBranch: 'path_a' },
                        { label: "B", text: "麻麻地囉，硬係覺得你哋兩個仲有啲嘢咁。", type: 'insecure', setBranch: 'path_b' }
                        ]
                    },
                    {
                        id: 's4_2_a',
                        branchId: 'path_a',
                        narrator: `${partner4} 安慰你話佢同前度無嘢，佢淨係在意你一個。不過，佢繼續講關於前度嘅嘢，你開始覺得有啲呷醋。你醒起上個禮拜有個你以前幾好感嘅人打嚟約你，但你當時無提。`,
                        dialogue: {
                        speaker: "內心獨白",
                        text: "佢係咁講個 Ex... 我應唔應該提下有人約我嗰單嘢?"
                        },
                        options: [
                        { label: "A", text: "唔提算數，費事佢呷醋。", type: 'secure' },
                        { label: "B", text: "扮無嘢提下有人約我，希望佢會覺得有啲呷醋。", type: 'insecure' }
                        ],
                        isEnd: true
                    },
                    {
                        id: 's4_2_b',
                        branchId: 'path_b',
                        narrator: `${partner4} 話：「我都唔明點解你會咁諗，你成日都亂咁擔心。」佢繼續講關於前度嘅嘢，你開始覺得有啲呷醋。你醒起上個禮拜有個你以前幾好感嘅人打嚟約你，但你當時無提。`,
                        dialogue: {
                        speaker: "內心獨白",
                        text: "佢係咁講個 Ex... 我應唔應該提下有人約我嗰單嘢?"
                        },
                        options: [
                        { label: "A", text: "唔提算數，費事佢呷醋。", type: 'secure' },
                        { label: "B", text: "扮無嘢提下有人約我，希望佢會覺得有啲呷醋。", type: 'insecure' }
                        ],
                        isEnd: true
                    }
                    ]
                }
                ];
            };

            const stories = userGender ? getStories(userGender) : [];

            const handleGenderSelect = (gender) => { setUserGender(gender); setGameState('intro'); };
            const handleStart = () => { setCurrentStoryIndex(0); setCurrentSceneIndex(0); setScores({ secure: 0, insecure: 0 }); setHistory([]); setBranchPath(null); setGameState('transition'); };
            const handleNextStory = () => { setGameState('playing'); };
            const handleOptionClick = (option) => {
                setScores(prev => ({ ...prev, [option.type]: prev[option.type] + 1 }));
                if (option.setBranch) setBranchPath(option.setBranch);
                const currentStory = stories[currentStoryIndex];
                const currentScene = currentStory.scenes[currentSceneIndex];
                if (currentScene.isEnd) {
                    if (currentStoryIndex + 1 < stories.length) {
                        setCurrentStoryIndex(prev => prev + 1);
                        setCurrentSceneIndex(0);
                        setBranchPath(null);
                        setGameState('transition');
                    } else {
                        setGameState('summary');
                    }
                    return;
                }
                let nextSceneIdx = currentSceneIndex + 1;
                if (currentStory.isBranching) {
                    const activeBranch = option.setBranch || branchPath;
                    const targetIndex = currentStory.scenes.findIndex(s => s.branchId === activeBranch);
                    if (targetIndex !== -1) nextSceneIdx = targetIndex;
                }
                if (nextSceneIdx < currentStory.scenes.length) {
                    setCurrentSceneIndex(nextSceneIdx);
                } else {
                    setGameState('summary'); 
                }
            };

            // --- RENDER STATES ---
            if (gameState === 'setup') {
                return (<div className="w-full h-[100dvh] bg-cyan-300 flex items-center justify-center font-sans p-[3vmin]"><div className="w-full max-w-lg bg-white border-[0.8vmin] border-black shadow-[1.5vmin_1.5vmin_0px_0px_rgba(0,0,0,1)] p-[4vmin] text-center rounded-lg flex flex-col justify-center"><h1 className="font-black uppercase mb-[4vmin] tracking-tight text-black transform -rotate-1" style={{fontSize: 'clamp(24px, 7vmin, 40px)'}}>請選擇你的性別</h1><p className="mb-[6vmin] text-gray-700 font-bold" style={{fontSize: 'clamp(16px, 4vmin, 22px)'}}>我們會根據你的性別調整故事角色，令你更有代入感。</p><div className="grid grid-cols-2 gap-[3vmin]"><button onClick={() => handleGenderSelect('M')} className="bg-blue-200 p-[3vmin] border-[0.6vmin] border-black hover:bg-blue-300 active:translate-y-1 active:shadow-none shadow-[0.8vmin_0.8vmin_0px_0px_rgba(0,0,0,1)] rounded-md flex flex-col items-center justify-center gap-[1vmin]"><User className="text-black" style={{fontSize: 'clamp(32px, 10vmin, 64px)'}}/><span className="font-black text-black" style={{fontSize: 'clamp(16px, 4.5vmin, 28px)'}}>我是男生</span></button><button onClick={() => handleGenderSelect('F')} className="bg-pink-200 p-[3vmin] border-[0.6vmin] border-black hover:bg-pink-300 active:translate-y-1 active:shadow-none shadow-[0.8vmin_0.8vmin_0px_0px_rgba(0,0,0,1)] rounded-md flex flex-col items-center justify-center gap-[1vmin]"><User className="text-black" style={{fontSize: 'clamp(32px, 10vmin, 64px)'}} /><span className="font-black text-black" style={{fontSize: 'clamp(16px, 4.5vmin, 28px)'}}>我是女生</span></button></div></div></div>);
            }
            if (gameState === 'intro') {
                return (<div className="w-full h-[100dvh] bg-yellow-400 flex flex-col items-center justify-center font-sans p-[3vmin]"><div className="w-full max-w-lg h-full max-h-[85dvh] bg-white border-[0.8vmin] border-black shadow-[1.5vmin_1.5vmin_0px_0px_rgba(0,0,0,1)] p-[4vmin] flex flex-col rounded-lg"><div className="flex justify-between items-center mb-[2vmin] border-b-[0.6vmin] border-black pb-[2vmin]"><h1 className="font-black uppercase tracking-tighter text-black transform -rotate-2" style={{fontSize: 'clamp(24px, 8vmin, 48px)'}}>戀愛大冒險</h1></div><div className="flex-1 flex flex-col justify-center items-center mb-[4vmin]"><div className="bg-blue-500 p-[4vmin] border-[0.6vmin] border-black shadow-[0.8vmin_0.8vmin_0px_0px_rgba(0,0,0,1)] mb-[4vmin] rounded-lg"><Heart color="white" fill="white" style={{fontSize: 'clamp(48px, 15vmin, 80px)'}} /></div><p className="font-bold leading-snug text-black text-center px-[2vmin]" style={{fontSize: 'clamp(16px, 4.5vmin, 24px)'}}>經歷四個唔同嘅戀愛故事。你嘅選擇將會反映你嘅依戀風格係屬於「安全型」定係「不安全型」。</p></div><button onClick={handleStart} className="w-full bg-red-500 text-white font-black py-[3vmin] border-[0.6vmin] border-black hover:bg-red-600 active:translate-y-1 active:shadow-none shadow-[0.8vmin_0.8vmin_0px_0px_rgba(0,0,0,1)] rounded-md transition-all" style={{fontSize: 'clamp(18px, 5vmin, 32px)'}}>開始遊戲</button></div></div>);
            }
            if (gameState === 'transition') {
                return (<div className="w-full h-[100dvh] bg-purple-600 flex flex-col items-center justify-center font-sans p-[3vmin]"><div className="w-full max-w-lg bg-white border-[0.8vmin] border-black shadow-[1.5vmin_1.5vmin_0px_0px_rgba(0,0,0,1)] p-[6vmin] text-center animate-in fade-in zoom-in duration-300 rounded-lg"><div className="inline-block bg-black text-white px-[3vmin] py-[1vmin] font-black uppercase mb-[3vmin] transform -rotate-2 border-[0.4vmin] border-white" style={{fontSize: 'clamp(14px, 4vmin, 24px)'}}>Coming Up Next</div><h2 className="font-black uppercase mb-[2vmin] leading-tight text-black" style={{fontSize: 'clamp(24px, 7vmin, 40px)'}}>{stories[currentStoryIndex].title}</h2><div className="w-1/3 h-[1vmin] bg-yellow-400 border-[0.3vmin] border-black mb-[6vmin] mx-auto transform rotate-3"></div><p className="text-gray-800 mb-[6vmin] font-bold" style={{fontSize: 'clamp(16px, 4.5vmin, 26px)'}}>準備好做決定未？</p><button onClick={handleNextStory} className="w-full bg-green-400 text-black font-black py-[3vmin] border-[0.6vmin] border-black hover:bg-green-500 active:translate-y-1 active:shadow-none shadow-[0.8vmin_0.8vmin_0px_0px_rgba(0,0,0,1)] rounded-md flex items-center justify-center gap-[2vmin]" style={{fontSize: 'clamp(18px, 5vmin, 32px)'}}><span>進入場景</span><ArrowRight strokeWidth={3} /></button></div></div>);
            }
            if (gameState === 'summary') {
                const total = scores.secure + scores.insecure;
                const securePercent = Math.round((scores.secure / total) * 100);
                return (<div className="w-full h-[100dvh] bg-teal-500 flex flex-col items-center justify-center font-sans p-[3vmin]"><div className="w-full max-w-lg h-full max-h-[90dvh] bg-white border-[0.8vmin] border-black shadow-[1.5vmin_1.5vmin_0px_0px_rgba(0,0,0,1)] p-[4vmin] flex flex-col rounded-lg"><h2 className="font-black uppercase mb-[2vmin] text-center text-black shrink-0" style={{fontSize: 'clamp(28px, 8vmin, 48px)'}}>結局！</h2><div className="grid grid-cols-2 gap-[3vmin] mb-[3vmin] shrink-0"><div className="bg-green-100 p-[2vmin] border-[0.6vmin] border-black text-center rounded-lg shadow-[0.6vmin_0.6vmin_0px_0px_rgba(0,0,0,1)]"><div className="font-black mb-1 text-black" style={{fontSize: 'clamp(32px, 10vmin, 60px)'}}>{scores.secure}</div><div className="font-bold uppercase text-black" style={{fontSize: 'clamp(12px, 3vmin, 18px)'}}>安全型</div></div><div className="bg-red-100 p-[2vmin] border-[0.6vmin] border-black text-center rounded-lg shadow-[0.6vmin_0.6vmin_0px_0px_rgba(0,0,0,1)]"><div className="font-black mb-1 text-black" style={{fontSize: 'clamp(32px, 10vmin, 60px)'}}>{scores.insecure}</div><div className="font-bold uppercase text-black" style={{fontSize: 'clamp(12px, 3vmin, 18px)'}}>不安全型</div></div></div><div className="mb-[2vmin] border-t-[0.6vmin] border-black pt-[2vmin] flex-1 overflow-y-auto min-h-0"><h3 className="font-bold mb-[1vmin] text-black" style={{fontSize: 'clamp(18px, 5vmin, 30px)'}}>分析</h3><p className="leading-relaxed text-black font-medium" style={{fontSize: 'clamp(16px, 4.5vmin, 24px)'}}>{securePercent > 70 ? "你主要係「安全型」依戀！你信任伴侶，肯坦誠溝通。" : securePercent > 40 ? "你係「混合型」。有時會信人，但有時又會亂諗呷醋。" : "你傾向「不安全型」。有壓力嗰陣，你容易呷醋或者想逃避。"}</p></div><button onClick={() => setGameState('setup')} className="w-full bg-yellow-400 text-black font-black py-[3vmin] border-[0.6vmin] border-black hover:bg-yellow-500 active:translate-y-1 active:shadow-none shadow-[0.8vmin_0.8vmin_0px_0px_rgba(0,0,0,1)] rounded-md flex justify-center items-center gap-[2vmin] shrink-0" style={{fontSize: 'clamp(18px, 5vmin, 32px)'}}><RefreshCcw />再玩一次</button></div></div>);
            }

            // --- PLAYING SCREEN ---
            const currentStory = stories[currentStoryIndex];
            const currentScene = currentStory.scenes[currentSceneIndex];
            const sceneKey = `${currentStory.id}-${currentScene.id}`;

            return (
                <div className="w-full h-[100dvh] bg-sky-200 flex flex-col items-center justify-center font-sans p-[2vmin] overflow-hidden">
                    <div className="w-full max-w-lg flex flex-col justify-center gap-[1.5vmin] h-full max-h-[100dvh]">
                        
                        {/* Header */}
                        <div className="shrink-0 flex justify-between items-center bg-white border-[0.6vmin] border-black px-[3vmin] py-[1.5vmin] shadow-[0.6vmin_0.6vmin_0px_0px_rgba(0,0,0,1)] rounded-md">
                            <div className="font-black uppercase tracking-wide truncate mr-2 text-black" style={{fontSize: 'clamp(16px, 5vmin, 24px)'}}>
                                {currentStory.title}
                            </div>
                            <div className="font-bold bg-black text-white px-[2vmin] py-[0.5vmin] whitespace-nowrap rounded-sm" style={{fontSize: 'clamp(12px, 3vmin, 16px)'}}>
                                {currentStoryIndex + 1} / {stories.length}
                            </div>
                        </div>

                        {/* SCENE CARD (Flexible height, text auto-scales to fit) */}
                        <div className="flex-1 min-h-0 bg-yellow-200 border-[0.6vmin] border-black p-0 relative shadow-[0.6vmin_0.6vmin_0px_0px_rgba(0,0,0,0.2)] rounded-md flex flex-col">
                            <div className="bg-black text-white px-[2vmin] py-[0.5vmin] font-bold uppercase inline-block border-b-[0.6vmin] border-r-[0.6vmin] border-black self-start relative z-10" style={{fontSize: 'clamp(10px, 2.5vmin, 14px)'}}>
                                SCENE
                            </div>
                            {/* The container for AutoFitText takes all remaining space in the card */}
                            <div className="p-[3vmin] pt-[1vmin] flex-1 overflow-hidden relative">
                                <AutoFitText text={currentScene.narrator} />
                            </div>
                        </div>

                        {/* DIALOGUE (Natural size) */}
                        <div className="flex-none flex flex-col items-start pl-0 md:pl-[2vmin] shrink-0">
                            <div className="shrink-0 mb-[0.5vmin] font-black uppercase text-black ml-[1vmin] tracking-wider flex items-center gap-[1vmin] bg-white border-[0.4vmin] border-black px-[1.5vmin] py-[0.2vmin] inline-flex transform -rotate-1" style={{fontSize: 'clamp(10px, 2.5vmin, 14px)'}}>
                                {currentScene.dialogue.speaker === '內心獨白' ? <BookOpen /> : <User />}
                                {currentScene.dialogue.speaker === '內心獨白' ? "內心獨白" : currentScene.dialogue.speaker}
                            </div>
                            
                            <div className={`relative w-full border-[0.6vmin] border-black p-[3vmin] rounded-xl shadow-[0.6vmin_0.6vmin_0px_0px_rgba(0,0,0,0.2)] overflow-y-auto max-h-[30dvh]
                                ${currentScene.dialogue.speaker === '內心獨白' ? 'bg-pink-50 border-dashed' : 'bg-white'}`}>
                                
                                <div className={`absolute top-[3vmin] -left-[1.5vmin] w-[2vmin] h-[2vmin] border-t-[0.6vmin] border-l-[0.6vmin] border-black bg-white transform -rotate-45 pointer-events-none 
                                    ${currentScene.dialogue.speaker === '內心獨白' ? 'hidden' : 'block'}`}></div>
                                <div className={`absolute top-[3vmin] -left-[2.5vmin] flex flex-col gap-[0.5vmin] items-center 
                                    ${currentScene.dialogue.speaker === '內心獨白' ? 'block' : 'hidden'}`}>
                                    <div className="w-[1vmin] h-[1vmin] rounded-full bg-pink-300 border-[0.2vmin] border-black"></div>
                                    <div className="w-[1.5vmin] h-[1.5vmin] rounded-full bg-pink-300 border-[0.2vmin] border-black"></div>
                                </div>

                                <p className="font-bold text-black leading-snug" style={{fontSize: 'clamp(16px, 5vmin, 28px)'}}>
                                "{currentScene.dialogue.text}"
                                </p>
                            </div>
                        </div>

                        {/* CHOICES (Natural size) */}
                        <div className="flex-none flex flex-col shrink-0 pt-[1vmin]">
                            <div className="shrink-0 font-bold mb-[1vmin] text-black uppercase tracking-widest flex items-center gap-[1vmin] ml-[0.5vmin]" style={{fontSize: 'clamp(10px, 2.5vmin, 14px)'}}>
                                <div className="bg-blue-500 text-white p-[0.5vmin] border-[0.3vmin] border-black"><MessageCircle /></div>
                                你的回應 (Your Reply)
                            </div>
                            <div className="grid grid-cols-1 gap-[1.5vmin]">
                                {currentScene.options.map((opt, idx) => (
                                <button 
                                    key={`${sceneKey}-${idx}`}
                                    onClick={() => handleOptionClick(opt)}
                                    className="group relative bg-white border-[0.6vmin] border-black p-[2vmin] text-left hover:bg-cyan-100 active:bg-cyan-200 transition-all active:scale-[0.98] shadow-[0.6vmin_0.6vmin_0px_0px_rgba(0,0,0,1)] active:shadow-none rounded-lg shrink-0"
                                >
                                    <div className="flex items-start gap-[2vmin]">
                                        <div className="bg-black text-white w-[6vmin] h-[6vmin] flex-shrink-0 flex items-center justify-center font-black rounded-md border-[0.3vmin] border-transparent group-hover:border-black" style={{fontSize: 'clamp(14px, 4vmin, 24px)'}}>
                                            {opt.label}
                                        </div>
                                        <span className="font-bold text-black group-hover:text-blue-800 leading-snug" style={{fontSize: 'clamp(14px, 4.5vmin, 24px)'}}>
                                            {opt.text}
                                        </span>
                                    </div>
                                </button>
                                ))}
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RelationshipComic />);
    </script>
</body>
</html>


